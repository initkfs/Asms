     1                                  BITS 16
     2                                  ORG 0x0000
     3                                  ; initkfs, 2018
     4                                  ; ---------------------
     5                                  ;https://stackoverflow.com/questions/50540401/drawing-pixels-in-vesa-graphic-mode
     6                                  ;http://www.drdobbs.com/programming-with-vesa-bios-extensions/184403213
     7                                  main:
     8 00000000 8CC8                        mov ax, cs
     9 00000002 8ED8                        mov ds, ax
    10                                       
    11 00000004 B8024F                      mov ax, 4f02h ;Set VBE video mode, http://www.columbia.edu/~em36/wpdos/videomodes.txt
    12 00000007 BB0301                      mov bx, 103h ; VBE mode number,  800x600x256, bpp 8
    13 0000000A CD10                        int 10h
    14                                      
    15                                      ; AX = Width
    16                                  	; BX = Height
    17                                  	; CL = Bits per pixel
    18                                  	;https://wiki.osdev.org/User:Omarrx024/VESA_Tutorial
    19 0000000C A3[0001]                    mov [width], ax
    20 0000000F 891E[0201]                  mov [height], bx
    21 00000013 880E[0401]                  mov [bpp], cl
    22                                  
    23                                  	;Get video mode info
    24 00000017 B8014F                  	mov ax, 4f01h ; Get VESA mode information
    25 0000001A B90501                  	mov cx, 105h ; Input: CX = VESA mode number from the video modes array
    26 0000001D BF[0000]                	mov di, modeInfo  ;Input: ES:DI = VESA Mode Information Structure.
    27 00000020 CD10                    	int 10h
    28 00000022 83F84F                  	cmp ax, 0x004F ; AX = 0x004F on success, other values indicate a BIOS error or a mode-not-supported error.
    29 00000025 7518                    	jne error
    30                                  	
    31                                  	;https://github.com/paulpela/asmlib/blob/master/pure64/pure64.asm
    32 00000027 A1[0800]                	mov ax, [modeInfo + 8] ;WinASegment == 0xa000,
    33 0000002A A30000                  	mov [VbeModeInfo + VbeModeInfo.segment_a], word ax
    34                                  	
    35 0000002D A10000                  	mov ax, [VbeModeInfo + VbeModeInfo.segment_a]
    36 00000030 8EC0                    	mov es, ax
    37                                  	
    38 00000032 31FF                    	xor di, di 	
    39                                  drawTopBorder:
    40 00000034 B00B                        mov al, 0x0b  ; color, http://www.fountainware.com/EXPL/vga_color_palettes.htm
    41 00000036 B9401F                      mov cx, 10*800
    42 00000039 F3AA                        rep stosb
    43                                  	
    44                                  waitKeyboard:
    45                                  	;Wait for any key press
    46 0000003B 31C0                    	xor ax, ax
    47 0000003D CD16                    	int 16h ; bios keyboard interrupt
    48                                  
    49                                  error:
    50                                  	;Restore DOS text mode
    51 0000003F B80300                  	mov ax, 0003h
    52 00000042 CD10                    	int 10h
    53                                  
    54                                  exit:
    55 00000044 B8004C                  	mov ax, 4c00h ; bios exit
    56 00000047 CD21                    	int 21h
    57                                  
    58                                  section .data
    59                                  ;TODO replace
    60                                  STRUC VbeModeInfo
    61 00000000 <res 00000002>          	.segment_a: resw 1
    62                                  ENDSTRUC
    63 00000000 <res 00000100>          modeInfo    resb 256
    64          ******************       warning: uninitialized space declared in .data section: zeroing
    65 00000100 <res 00000002>          width resw 1
    66          ******************       warning: uninitialized space declared in .data section: zeroing
    67 00000102 <res 00000002>          height resw 1
    68          ******************       warning: uninitialized space declared in .data section: zeroing
    69 00000104 <res 00000002>          bpp resw 1
    70          ******************       warning: uninitialized space declared in .data section: zeroing
    71                                  
    72                                  
    73                                  
    74                                  
    75                                  
    76                                  
    77                                  
    78                                  
    79                                  
    80                                  
    81                                  
    82                                  
    83                                  
    84                                  
    85                                  
    86                                  
    87                                  
    88                                  
    89                                  
    90                                  
